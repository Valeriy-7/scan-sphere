(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8777:(e,t,s)=>{Promise.resolve().then(s.bind(s,46401))},46401:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var i=s(95155),a=s(66766),r=s(12115),l=s(76408),n=s(60760),c=s(10351);let o=e=>{let{products:t,onSearchComplete:s}=e,[o,d]=(0,r.useState)(""),[x,m]=(0,r.useState)(""),[h,p]=(0,r.useState)(""),[u,f]=(0,r.useState)([]),[y,j]=(0,r.useState)(!1),g=async()=>{if(!o||!x){j(!0),f([]),setTimeout(()=>{f(t),j(!1)},800);return}try{j(!0),f([]);let e=await fetch("/api/parser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o,myArticleId:x,competitorArticleId:h||""})});if(!e.ok)throw Error("Ошибка при выполнении запроса");let t=await e.json(),i=[t.products.my];h&&t.products.competitor&&i.push(t.products.competitor),f(i),s&&s(t)}catch(e){console.error("Ошибка при поиске:",e),alert("Произошла ошибка при поиске. Пожалуйста, попробуйте еще раз.")}finally{j(!1)}},N=e=>{"Enter"===e.key&&g()};return(0,i.jsxs)(l.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"p-4 rounded-xl h-full flex flex-col relative overflow-hidden",style:{background:"radial-gradient(circle at top right, #f8c4ff, #a468ef, #7e52eb, #667aef)",backgroundSize:"cover",backgroundPosition:"center",borderRadius:"1rem"},children:[(0,i.jsxs)(l.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"flex flex-col gap-3 mb-4 z-10",children:[(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("input",{type:"text",value:o,onChange:e=>d(e.target.value),onKeyDown:N,placeholder:"Введите запрос...",className:"bg-white/90 w-full px-4 py-2.5 rounded-full outline-none text-sm shadow-md"}),(0,i.jsx)(l.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:g,className:"absolute right-1 top-1 bg-pink-500 text-white rounded-full w-8 h-8 flex items-center justify-center shadow-md",children:(0,i.jsx)(c.dyV,{size:18})})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)("div",{className:"relative flex-1",children:[(0,i.jsx)("div",{className:"absolute left-3 top-2.5 text-gray-400",children:(0,i.jsx)(c.est,{size:16})}),(0,i.jsx)("input",{type:"text",value:x,onChange:e=>m(e.target.value),onKeyDown:N,placeholder:"Мой артикул",className:"bg-white/80 w-full pl-9 pr-3 py-2 rounded-full outline-none text-sm shadow-md"})]}),(0,i.jsxs)("div",{className:"relative flex-1",children:[(0,i.jsx)("div",{className:"absolute left-3 top-2.5 text-gray-400",children:(0,i.jsx)(c.est,{size:16})}),(0,i.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),onKeyDown:N,placeholder:"Артикул конк.",className:"bg-white/80 w-full pl-9 pr-3 py-2 rounded-full outline-none text-sm shadow-md"})]})]})]}),y&&(0,i.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},className:"flex-1 flex items-center justify-center",children:(0,i.jsx)("div",{className:"flex justify-center",children:(0,i.jsx)("div",{className:"w-10 h-10 border-4 border-transparent border-t-pink-500 rounded-full animate-spin"})})}),!y&&(0,i.jsxs)("div",{className:"flex-1 overflow-auto flex flex-col gap-2",children:[(0,i.jsx)(n.N,{children:u&&u.length>0?u.map((e,t)=>(0,i.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4,delay:.15*t,type:"spring",stiffness:100},whileHover:{scale:1.02,boxShadow:"0 4px 6px rgba(0,0,0,0.1)"},className:"bg-white rounded-xl p-3 flex items-center",children:(0,i.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,i.jsx)(l.P.div,{className:"relative w-16 h-16 min-w-16 rounded-lg overflow-hidden",whileHover:{scale:1.05},children:(0,i.jsx)(a.default,{src:e.image,alt:e.name,width:64,height:64,className:"object-cover",onError:e=>{let t=e.target;t.onerror=null,t.src="/images/no-image.svg"}})}),(0,i.jsxs)("div",{className:"flex-1 mr-2",children:[(0,i.jsx)("h3",{className:"font-bold text-sm",children:e.name}),(0,i.jsx)("p",{className:"text-gray-500 text-xs",children:e.articleId})]}),(0,i.jsxs)("div",{className:"font-bold text-right whitespace-nowrap bg-gray-100 px-3 py-1 rounded-full",children:[e.price.toLocaleString()," ₽"]})]})},t)):null}),0===u.length&&(0,i.jsxs)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"text-center text-white/80 flex-1 flex flex-col justify-center items-center p-4",children:[(0,i.jsx)(l.P.div,{animate:{scale:[1,1.05,1],rotate:[0,2,-2,0]},transition:{repeat:1/0,repeatType:"mirror",duration:2},children:(0,i.jsx)(c.est,{size:40,className:"mb-3"})}),(0,i.jsx)("p",{className:"text-sm",children:"Введите артикулы и нажмите поиск для сравнения товаров"})]})]})]})},d=e=>{let{positions:t}=e;return(0,i.jsxs)("div",{className:"bg-white/40 backdrop-blur-md rounded-xl border border-white/30 shadow-lg shadow-purple-900/5 p-3 h-full flex flex-col",style:{maxHeight:"100%"},children:[(0,i.jsx)("div",{className:"mb-2 flex items-center justify-between",children:(0,i.jsx)("h3",{className:"text-gray-800 font-medium",children:"Позиции в городах"})}),t.some(e=>e.competitorPosition&&"-"!==e.competitorPosition)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"grid grid-cols-3 mb-2 pb-2 border-b border-white/30 select-none pointer-events-none text-sm",children:[(0,i.jsx)("div",{className:"text-gray-800 font-medium text-left",children:"Город"}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-gray-800 font-medium",children:"Страница"}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 flex justify-center mt-1",children:[(0,i.jsx)("span",{className:"text-purple-700 w-10 text-center",children:"Моя"}),(0,i.jsx)("span",{className:"text-gray-600 w-10 text-center",children:"Конк."})]})]}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-gray-800 font-medium",children:"Позиция"}),(0,i.jsxs)("div",{className:"text-xs text-gray-500 flex justify-center mt-1",children:[(0,i.jsx)("span",{className:"text-purple-700 w-10 text-center",children:"Моя"}),(0,i.jsx)("span",{className:"text-gray-600 w-10 text-center",children:"Конк."})]})]})]}),(0,i.jsx)("div",{className:"overflow-auto flex-1",style:{height:"calc(100% - 100px)",minHeight:"120px",maxHeight:"calc(100% - 100px)"},children:t.length>0?(0,i.jsx)("div",{className:"h-auto",children:t.map((e,s)=>(0,i.jsxs)(l.P.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.05*s},className:"grid grid-cols-3 py-1.5 text-sm ".concat(s!==t.length-1?"border-b border-white/20":""," hover:bg-white/30 transition-colors duration-200 select-none"),children:[(0,i.jsx)("div",{className:"text-left font-medium pl-2 truncate",children:e.city}),(0,i.jsx)("div",{className:"text-center",children:(0,i.jsxs)("div",{className:"flex justify-center",children:[(0,i.jsx)("span",{className:"text-purple-700 font-medium w-10",children:e.myPage}),(0,i.jsx)("span",{className:"text-gray-600 font-medium w-10",children:e.competitorPage})]})}),(0,i.jsx)("div",{className:"text-center",children:(0,i.jsxs)("div",{className:"flex justify-center",children:[(0,i.jsx)("span",{className:"text-purple-700 font-medium w-10",children:e.myPosition}),(0,i.jsx)("span",{className:"text-gray-600 font-medium w-10",children:e.competitorPosition})]})})]},"".concat(e.city,"-").concat(s)))}):(0,i.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},className:"h-[120px] flex items-center justify-center text-gray-600 text-sm",children:"Нет данных о позициях"})}),(0,i.jsxs)("div",{className:"mt-auto pt-2 border-t border-white/30 flex justify-center gap-4 text-xs",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-3 h-3 rounded-full bg-purple-700"}),(0,i.jsx)("span",{className:"text-gray-700",children:"Мои"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-3 h-3 rounded-full bg-gray-600"}),(0,i.jsx)("span",{className:"text-gray-700",children:"Конкурент"})]})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"grid grid-cols-3 mb-2 pb-2 border-b border-white/30 select-none pointer-events-none text-sm",children:[(0,i.jsx)("div",{className:"text-gray-800 font-medium text-left",children:"Город"}),(0,i.jsx)("div",{className:"text-center text-gray-800 font-medium",children:"Страница"}),(0,i.jsx)("div",{className:"text-center text-gray-800 font-medium",children:"Позиция"})]}),(0,i.jsx)("div",{className:"overflow-auto flex-1",style:{height:"calc(100% - 100px)",minHeight:"120px",maxHeight:"calc(100% - 100px)"},children:t.length>0?(0,i.jsx)("div",{className:"h-auto",children:t.map((e,s)=>(0,i.jsxs)(l.P.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.05*s},className:"grid grid-cols-3 py-1.5 text-sm ".concat(s!==t.length-1?"border-b border-white/20":""," hover:bg-white/30 transition-colors duration-200 select-none"),children:[(0,i.jsx)("div",{className:"text-left font-medium pl-2 truncate",children:e.city}),(0,i.jsx)("div",{className:"text-center",children:(0,i.jsx)("span",{className:"text-purple-700 font-medium",children:e.myPage})}),(0,i.jsx)("div",{className:"text-center",children:(0,i.jsx)("span",{className:"text-purple-700 font-medium",children:e.myPosition})})]},"".concat(e.city,"-").concat(s)))}):(0,i.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},className:"h-[120px] flex items-center justify-center text-gray-600 text-sm",children:"Нет данных о позициях"})}),(0,i.jsx)("div",{className:"mt-auto pt-2 border-t border-white/30 flex justify-center text-xs",children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("div",{className:"w-3 h-3 rounded-full bg-purple-700"}),(0,i.jsx)("span",{className:"text-gray-700",children:"Мои позиции"})]})})]})]})};var x=s(83540),m=s(62638),h=s(94754),p=s(96025),u=s(16238),f=s(83394),y=s(36079),j=s(54811),g=s(21374),N=s(94011);let v=e=>{let{data:t}=e,[s,a]=(0,r.useState)(0),[c,o]=(0,r.useState)([]),[d,v]=(0,r.useState)([0,0]);if((0,r.useEffect)(()=>{a(e=>e+1);let e=t.some(e=>e.competitorPosition>0),s=t.map(t=>{let s=t.myPosition||0,i=t.competitorPosition||0,a=e&&i>0,r=a?Math.min(s,i):s,l=a?Math.max(s,i):s,n=a?Math.abs(s-i):0,c=!a||s>0&&0===i||s>0&&i>0&&s<=i,o=a?Math.max(s,i):s,d=a?Math.min(s,i):s,x=l-o,m=d-r;return{city:t.city,myPosition:s,competitorPosition:i,low:r,high:l,height:0===n?1e-4:n,isWinning:c,hasCompetitor:a,errorHighUp:c&&a?x:null,errorLowUp:c&&a?m:null,errorHighDown:!c&&a?x:null,errorLowDown:!c&&a?m:null,errorLineHigh:o+x/2,errorLineLow:d-m/2}}).filter(e=>e.myPosition>0||e.competitorPosition>0);if(o(s),s.length>0){let e=s.flatMap(e=>[e.myPosition,e.competitorPosition>0?e.competitorPosition:null]).filter(e=>null!==e);v([Math.min(...e),Math.max(...e)])}},[t]),0===t.length)return(0,i.jsx)("div",{className:"bg-white/40 backdrop-blur-md rounded-xl border border-white/30 shadow-lg shadow-purple-900/5 p-3 h-full flex flex-col justify-center items-center",children:(0,i.jsx)("p",{className:"text-gray-600 text-center mb-4",children:"Выполните поиск чтобы увидеть позиции товара в городах"})});let b=e=>void 0===e||0===e?"":String(e);return(0,i.jsxs)(l.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-white/40 backdrop-blur-md rounded-xl border border-white/30 shadow-lg shadow-purple-900/5 p-3 h-full flex flex-col",children:[(0,i.jsxs)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},className:"flex justify-between items-center mb-2",children:[(0,i.jsx)("h3",{className:"font-medium text-gray-800",children:"Сравнение позиций"}),(0,i.jsxs)("div",{className:"flex gap-4 text-xs",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)("div",{className:"w-4 h-4 rounded-sm bg-green-500 shadow-lg shadow-green-500/30"}),(0,i.jsx)("span",{className:"text-gray-600",children:"Мои товары"})]}),t.some(e=>e.competitorPosition>0)&&(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)("div",{className:"w-4 h-4 rounded-sm bg-red-500 shadow-lg shadow-red-500/30"}),(0,i.jsx)("span",{className:"text-gray-600",children:"Товары конкурента"})]})]})]}),(0,i.jsx)("div",{className:"flex-1 relative",children:(0,i.jsx)(n.N,{mode:"wait",children:(0,i.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4},className:"absolute inset-0",children:(0,i.jsx)(x.u,{width:"100%",height:"100%",children:(0,i.jsxs)(m.X,{data:c,margin:{top:40,right:30,left:15,bottom:40},barSize:40,children:[(0,i.jsx)(h.d,{strokeDasharray:"3 3",horizontal:!0,vertical:!1,stroke:"#e2e8f0"}),(0,i.jsx)(p.W,{dataKey:"city",tickLine:!1,axisLine:{stroke:"#cbd5e1"},tick:{fill:"#64748b",fontSize:12}}),(0,i.jsx)(u.h,{type:"number",domain:[e=>Math.max(1,e-2),e=>e+2],tickCount:5,axisLine:{stroke:"#cbd5e1"},tickLine:{stroke:"#cbd5e1"},tick:{fill:"#64748b",fontSize:12},reversed:!0}),(0,i.jsx)(f.y,{dataKey:"low",fillOpacity:0,stackId:"stack"}),(0,i.jsxs)(f.y,{dataKey:"height",stackId:"stack",barSize:40,isAnimationActive:!0,fill:"#4ade80",children:[(0,i.jsx)(y.Z,{dataKey:"competitorPosition",position:"top",offset:6,fill:"#ff4747",fontSize:12,fontWeight:"bold",formatter:b}),(0,i.jsx)(y.Z,{dataKey:"myPosition",position:"bottom",offset:6,fill:"#4ade80",fontSize:12,fontWeight:"bold",formatter:b}),c.map((e,t)=>(0,i.jsx)(j.f,{fill:e.isWinning?"#4ade80":"#f87171",stroke:e.isWinning?"#22c55e":"#ef4444",style:{filter:"drop-shadow(0 4px 3px rgb(".concat(e.isWinning?"34 197 94":"239 68 68"," / 0.4))")}},"cell-".concat(t)))]}),(0,i.jsx)(g.N,{dataKey:"errorLineLow",stroke:"none",isAnimationActive:!1,dot:!1,children:(0,i.jsx)(N.u,{dataKey:"errorLowDown",width:3,strokeWidth:2,stroke:"#f87171"})}),(0,i.jsx)(g.N,{dataKey:"errorLineHigh",stroke:"none",isAnimationActive:!1,dot:!1,children:(0,i.jsx)(N.u,{dataKey:"errorHighDown",width:3,strokeWidth:2,stroke:"#f87171"})}),(0,i.jsx)(g.N,{dataKey:"errorLineHigh",stroke:"none",isAnimationActive:!1,dot:!1,children:(0,i.jsx)(N.u,{dataKey:"errorHighUp",width:3,strokeWidth:2,stroke:"#4ade80"})}),(0,i.jsx)(g.N,{dataKey:"errorLineLow",stroke:"none",isAnimationActive:!1,dot:!1,children:(0,i.jsx)(N.u,{dataKey:"errorLowUp",width:3,strokeWidth:2,stroke:"#4ade80"})})]})})},"chart-".concat(s))})}),(0,i.jsx)("div",{className:"mt-auto pt-2 text-center text-xs text-gray-500",children:(0,i.jsx)("span",{children:"Чем ниже значение, тем лучше позиция в поиске"})})]})},b=e=>{let{history:t,isLoading:s=!1,searchPerformed:a=!1,currentQuery:r=""}=e,n=[];t.forEach(e=>{n.some(t=>t.date===e.date)||n.push(e)});let o=n.slice(0,6),d=(e,t)=>1===t?e:(t-1)*100+e;return a?(0,i.jsxs)("div",{className:"bg-white/40 backdrop-blur-md rounded-xl border border-white/30 shadow-lg shadow-purple-900/5 p-4 h-full flex flex-col",children:[s&&(0,i.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},className:"flex-1 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-12 h-12 border-4 border-white border-t-purple-500 rounded-full animate-spin mb-3"}),(0,i.jsx)("p",{className:"text-gray-700",children:"Загрузка истории..."})]})}),!s&&0===o.length&&(0,i.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},className:"flex-1 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"flex flex-col items-center text-gray-600",children:[(0,i.jsx)(c.Ohp,{size:36,className:"mb-3"}),(0,i.jsx)("p",{children:"Нет истории поиска для данного товара"}),(0,i.jsx)("p",{className:"text-sm mt-1",children:"Выполните поиск с этим же артикулом повторно в будущем, чтобы увидеть динамику изменения позиций"})]})}),!s&&o.length>0&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.4},className:"flex items-center mb-3",children:(0,i.jsx)(l.P.h3,{initial:{x:-20},animate:{x:0},transition:{duration:.5,delay:.2},className:"font-medium text-lg text-gray-800 mr-auto overflow-hidden text-ellipsis",children:(0,i.jsxs)("span",{className:"flex items-center flex-wrap",children:[(0,i.jsx)("span",{className:"mr-1",children:"История"}),(0,i.jsx)("span",{className:"font-medium text-purple-700",children:o[0].myArticleId}),o[0].hasCompetitor&&o[0].competitorArticleId&&(0,i.jsxs)("span",{className:"text-xs bg-purple-100 text-purple-800 ml-1 px-1 rounded",children:["vs ",o[0].competitorArticleId]}),r&&(0,i.jsxs)("span",{className:"text-sm font-normal text-gray-500 ml-1 whitespace-nowrap",children:["\xab",r,"\xbb"]})]})})}),(0,i.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-6 gap-3 w-full flex-1 overflow-auto",children:o.map((e,t)=>(0,i.jsxs)(l.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1*t,duration:.4},className:"rounded-xl border border-purple-100 flex flex-col h-full min-h-0 overflow-hidden bg-gradient-to-b from-white/60 to-white/40",children:[(0,i.jsx)("div",{className:"bg-purple-600 text-white py-2 px-3 text-center font-medium text-sm flex flex-col",children:(0,i.jsx)("span",{children:e.date})}),(0,i.jsx)("div",{className:"flex-1 min-h-0 overflow-auto p-0",children:(0,i.jsxs)("table",{className:"w-full text-sm",children:[(0,i.jsx)("thead",{className:"bg-purple-50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"text-left py-1.5 px-2 text-gray-700 font-medium border-b border-purple-100",children:"Город"}),(0,i.jsx)("th",{className:"text-center py-1.5 px-1 text-gray-700 font-medium border-b border-purple-100",children:"Мои"}),e.hasCompetitor&&(0,i.jsx)("th",{className:"text-center py-1.5 px-1 text-gray-700 font-medium border-b border-purple-100",children:"Конкурент"})]})}),(0,i.jsx)("tbody",{children:e.positions.map((t,s)=>{let a=d(t.rank,t.pageRank),r=t.competitorRank&&t.competitorPageRank?d(t.competitorRank,t.competitorPageRank):void 0;return(0,i.jsxs)("tr",{className:"hover:bg-purple-50 transition-colors border-b border-purple-50",children:[(0,i.jsx)("td",{className:"py-1.5 px-2 text-gray-700 font-medium",children:t.city}),(0,i.jsx)("td",{className:"py-1.5 px-1 text-center text-purple-700 font-medium",children:a}),e.hasCompetitor&&(0,i.jsx)("td",{className:"py-1.5 px-1 text-center text-gray-600 font-medium",children:r||"–"})]},s)})})]})})]},t))})]})]}):(0,i.jsxs)("div",{className:"bg-white/40 backdrop-blur-md rounded-xl border border-white/30 shadow-lg shadow-purple-900/5 p-4 h-full flex flex-col items-center justify-center",children:[(0,i.jsx)(l.P.div,{animate:{scale:[1,1.05,1],rotate:[0,1,-1,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},className:"text-purple-600 mb-5",children:(0,i.jsx)(c.CKj,{size:40})}),(0,i.jsx)("p",{className:"text-gray-600 text-center mb-2",children:"Выполните поиск товаров по ключевому запросу"}),(0,i.jsx)("p",{className:"text-gray-500 text-sm text-center",children:"История позиций товара будет отображаться здесь"})]})},w=e=>{let{onComplete:t}=e,[s,c]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=setTimeout(()=>{c(!1),t&&t()},2500);return()=>clearTimeout(e)},[t]),(0,i.jsx)(n.N,{children:s&&(0,i.jsx)(l.P.div,{initial:{opacity:1},exit:{opacity:0},transition:{duration:.5},className:"fixed inset-0 flex items-center justify-center z-50 bg-black",children:(0,i.jsxs)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"flex flex-col items-center",children:[(0,i.jsx)(l.P.div,{initial:{scale:1},animate:{scale:1.2},transition:{duration:4,ease:"easeOut",repeat:1/0,repeatType:"loop",repeatDelay:0},className:"mb-6 relative w-[600px] h-[600px]",children:(0,i.jsx)(a.default,{src:"/images/logo.png",alt:"Логотип СФЕРА",fill:!0,className:"object-contain",priority:!0})}),(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-white text-lg font-medium",children:"Загрузка"}),(0,i.jsxs)("div",{className:"flex justify-center gap-2 mt-3",children:[(0,i.jsx)(l.P.div,{animate:{opacity:[.4,1,.4],scaleY:[.6,1,.6]},transition:{duration:1.2,repeat:1/0,ease:"easeInOut"},className:"w-1 h-4 bg-white rounded-full"}),(0,i.jsx)(l.P.div,{animate:{opacity:[.4,1,.4],scaleY:[.6,1,.6]},transition:{duration:1.2,repeat:1/0,ease:"easeInOut",delay:.2},className:"w-1 h-4 bg-white rounded-full"}),(0,i.jsx)(l.P.div,{animate:{opacity:[.4,1,.4],scaleY:[.6,1,.6]},transition:{duration:1.2,repeat:1/0,ease:"easeInOut",delay:.4},className:"w-1 h-4 bg-white rounded-full"})]})]})]})})})},P=e=>{let{children:t}=e,[s,a]=(0,r.useState)(!1),[l,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(s){let e=setTimeout(()=>{n(!0)},300);return()=>clearTimeout(e)}},[s]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w,{onComplete:()=>a(!0)}),(0,i.jsx)("div",{className:"transition-opacity duration-500 ".concat(l?"opacity-100":"opacity-0"),children:t})]})};function k(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)([]),[n,x]=(0,r.useState)([]),[m,h]=(0,r.useState)(!0),[p,u]=(0,r.useState)(!1),[f,y]=(0,r.useState)(""),[j,g]=(0,r.useState)("");(0,r.useEffect)(()=>{N()},[]);let N=async()=>{try{h(!0);let e=new URLSearchParams;j&&e.append("articleId",j),f&&e.append("query",f);let t=e.toString()?"?".concat(e.toString()):"",s=await fetch("/api/history".concat(t));if(!s.ok)throw Error("Ошибка при загрузке истории");let i=await s.json();x(i),i.length>0&&w(i[0])}catch(e){console.error("Ошибка загрузки истории:",e)}finally{h(!1)}},w=e=>{t(e.positions.map(e=>({city:e.city,myPosition:1===e.pageRank?e.rank:(e.pageRank-1)*100+e.rank,competitorPosition:e.competitorRank&&e.competitorPageRank?1===e.competitorPageRank?e.competitorRank:(e.competitorPageRank-1)*100+e.competitorRank:0})))},k={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:80}}};return(0,i.jsx)(P,{children:(0,i.jsx)(l.P.main,{initial:"hidden",animate:"visible",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.2,delayChildren:.3}}},className:"h-screen overflow-hidden p-3",children:(0,i.jsxs)("div",{className:"h-full max-w-full mx-auto flex flex-col",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-3 mb-3",style:{height:"50%"},children:[(0,i.jsx)(l.P.div,{className:"lg:col-span-3 h-full",variants:k,children:(0,i.jsx)(o,{products:[],onSearchComplete:e=>{var s,i;a(e.positions),t(e.chartData),u(!0),y(e.query||""),(null==(i=e.products)||null==(s=i.my)?void 0:s.articleId)&&(j!==e.products.my.articleId&&x([]),g(e.products.my.articleId)),setTimeout(()=>{N()},300)}})}),(0,i.jsx)(l.P.div,{className:"lg:col-span-3 h-full",variants:k,children:p?(0,i.jsx)(d,{positions:s}):(0,i.jsx)(()=>(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center bg-white/40 backdrop-blur-md rounded-xl border border-white/30 shadow-lg shadow-purple-900/5 p-4",children:[(0,i.jsx)(l.P.div,{animate:{scale:[1,1.05,1],rotate:[0,1,-1,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},className:"text-purple-600 mb-4",children:(0,i.jsx)(c.vQY,{size:40})}),(0,i.jsxs)("p",{className:"text-gray-600 text-center",children:["Введите поисковый запрос и артикулы товаров,",(0,i.jsx)("br",{}),"чтобы увидеть их позиции в городах"]})]}),{})}),(0,i.jsx)(l.P.div,{className:"lg:col-span-6 h-full",variants:k,children:p?(0,i.jsx)(v,{data:e}):(0,i.jsx)(()=>(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center bg-white/40 backdrop-blur-md rounded-xl border border-white/30 shadow-lg shadow-purple-900/5 p-4",children:[(0,i.jsx)(l.P.div,{animate:{scale:[1,1.05,1],rotate:[0,1,-1,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},className:"text-purple-600 mb-4",children:(0,i.jsx)(c.z1n,{size:40})}),(0,i.jsxs)("p",{className:"text-gray-600 text-center",children:["Выполните поиск, чтобы увидеть сравнительный анализ",(0,i.jsx)("br",{}),"позиций товаров на графике"]})]}),{})})]}),(0,i.jsx)(l.P.div,{variants:k,style:{height:"50%"},children:(0,i.jsx)(b,{history:n,isLoading:m,searchPerformed:p,currentQuery:f})})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[844,680,441,684,358],()=>t(8777)),_N_E=e.O()}]);